import { useEffect, useState } from "react"
import dynamic from "next/dynamic"
import { MDXRemote } from "next-mdx-remote/rsc"
import { VFileCompatible } from "vfile"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Separator } from "@/components/ui/separator"

interface VulnerabilityDetailsProps {
  vulnerability: {
    title: string
    description: string
    severity: string
    details: string
    prevention: string
    reference: string
    publisher: string
    content?: string
    slug: string
  }
}

export default async function VulnerabilityDetails({
  vulnerability,
}: VulnerabilityDetailsProps) {
  const mdxSource: VFileCompatible = await import(
    `@/markdown/${vulnerability.slug}`
  )

  return (
    <div>
      <Card className="w-full lg:h-auto max-h-screen overflow-auto">
        <CardHeader>
          <CardTitle className="text-2xl">{vulnerability.title}</CardTitle>
          <div className="flex flex-col space-y-2 mt-2">
            <div className="flex items-center space-x-2">
              <span className="text-sm font-semibold italic">Reference:</span>
              <a
                href={vulnerability.reference}
                target="_blank"
                rel="noopener noreferrer"
                className="text-sm text-blue-500 hover:underline break-all italic"
              >
                {vulnerability.reference.length > 30
                  ? `${vulnerability.reference.substring(0, 30)}...`
                  : vulnerability.reference}
              </a>
            </div>
            <div className="flex items-center space-x-2">
              <span className="text-sm font-semibold italic">Publisher:</span>
              <span className="text-sm italic">{vulnerability.publisher}</span>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          <h3 className="text-lg font-semibold mb-2">Description</h3>
          <article className="prose prose-headings:mt-8 prose-headings:font-semibold prose-headings:text-black prose-h1:text-5xl prose-h2:text-4xl prose-h3:text-3xl prose-h4:text-2xl prose-h5:text-xl prose-h6:text-lg dark:prose-headings:text-white">
            <MDXRemote source={mdxSource} />
          </article>
        </CardContent>
      </Card>
    </div>
  )
}
